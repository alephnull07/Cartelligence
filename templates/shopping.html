{% extends "base.html" %}

{% block title %}Shopping List{% endblock %}

{% block content %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping - Cartelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .feature-card {
            border: none;
            border-radius: 12px;
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
            background-color: #ffffff;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: #2e5233;
            margin-bottom: 1rem;
        }

        .feature-card .card-header {
            background-color: #4a7a50;
            color: white;
            font-weight: 500;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .result-card {
            display: none;
            border-radius: 12px;
            margin-top: 25px;
            border: none;
        }

        .result-card .card-header {
            background-color: #2e5233;
            color: white;
        }

        .nutrition-table th {
            background-color: #f0f7ed;
        }

        .btn-feature {
            background-color: #4a7a50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
        }

        .btn-feature:hover {
            background-color: #2e5233;
            color: white;
        }

        .shopping-header {
            background-color: #2e5233;
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
    </style>
</head>

<body style="background-color: #f5ece5; font-family: 'Roboto', sans-serif;">

    <!-- Main Content -->
    <div class="container py-5">
        <!-- Shopping Header -->
        <div class="shopping-header mb-4 d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-0">Smart Shopping</h1>
                <p class="lead mb-0">Make better shopping decisions with AI-powered insights</p>
            </div>
            <i class="bi bi-cart4" style="font-size: 2.5rem;"></i>
        </div>

        <!-- Features Section -->
        <div class="row g-4 mb-4">
            <!-- Alternative Ingredient Card -->
            <div class="col-lg-6">
                <div class="card feature-card shadow-sm">
                    <div class="card-header py-3">
                        <h4 class="mb-0"><i class="bi bi-arrow-repeat me-2"></i>Find Alternatives</h4>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="text-center mb-3">
                            <i class="bi bi-shuffle feature-icon"></i>
                            <h5>Ingredient Alternatives</h5>
                            <p class="text-muted">Find healthier or budget-friendly substitutes for any ingredient</p>
                        </div>
                        <div class="mt-auto">
                            <div class="input-group">
                                <input type="text" class="form-control" id="alternativeInput"
                                    placeholder="e.g., dairy milk, white flour, sugar">
                                <button class="btn btn-feature" id="alternativeBtn" type="button">
                                    <i class="bi bi-search me-2"></i>Find Alternatives
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Nutrition Insights Card -->
            <div class="col-lg-6">
                <div class="card feature-card shadow-sm">
                    <div class="card-header py-3">
                        <h4 class="mb-0"><i class="bi bi-pie-chart-fill me-2"></i>Nutrition Insights</h4>
                    </div>
                    <div class="card-body d-flex flex-column">
                        <div class="text-center mb-3">
                            <i class="bi bi-clipboard2-pulse feature-icon"></i>
                            <h5>Nutritional Information</h5>
                            <p class="text-muted">Get detailed nutrition facts and health benefits</p>
                        </div>
                        <div class="mt-auto">
                            <div class="input-group">
                                <input type="text" class="form-control" id="nutritionInput"
                                    placeholder="e.g., avocado, quinoa, salmon">
                                <button class="btn btn-feature" id="nutritionBtn" type="button">
                                    <i class="bi bi-search me-2"></i>Get Nutrition Info
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="row mt-4">
            <div class="col-12">
                <!-- Alternative Results Card -->
                <div class="card result-card shadow-sm mb-4" id="alternativeResultCard">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-arrow-repeat me-2"></i>Alternative Options</h5>
                        <button type="button" class="btn-close btn-close-white" aria-label="Close"
                            onclick="document.getElementById('alternativeResultCard').style.display = 'none';"></button>
                    </div>
                    <div class="card-body">
                        <div id="alternativeLoader" class="text-center py-5" style="display: none;">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Finding the best alternatives...</p>
                        </div>
                        <div class="row" id="ai-alternative-container">
                            <div class="col-12">
                                <div id="ai-alternative"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nutrition Results Card -->
                <div class="card result-card shadow-sm" id="nutritionResultCard">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-pie-chart-fill me-2"></i>Nutrition Information</h5>
                        <button type="button" class="btn-close btn-close-white" aria-label="Close"
                            onclick="document.getElementById('nutritionResultCard').style.display = 'none';"></button>
                    </div>
                    <div class="card-body">
                        <div id="nutritionLoader" class="text-center py-5" style="display: none;">
                            <div class="spinner-border text-success" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Analyzing nutritional data...</p>
                        </div>
                        <div class="row" id="ai-nutrition-container">
                            <div class="col-12">
                                <div id="ai-nutrition"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Alternative ingredients functionality
        document.getElementById("alternativeBtn").addEventListener("click", function () {
            let userInput = document.getElementById("alternativeInput").value.trim();

            if (userInput !== "") {
                // Show loading state and result card
                document.getElementById("alternativeLoader").style.display = "block";
                document.getElementById("alternativeResultCard").style.display = "block";
                document.getElementById("ai-alternative").innerHTML = "";

                fetch('/submit_alternative', {
                    method: 'POST',
                    body: JSON.stringify({ alternative: userInput }),
                    headers: { 'Content-Type': 'application/json' }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Format the response better
                        let formattedResponse = formatAlternativeResponse(data, userInput);
                        document.getElementById("ai-alternative").innerHTML = formattedResponse;
                        document.getElementById("alternativeLoader").style.display = "none";
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        document.getElementById("alternativeLoader").style.display = "none";
                        document.getElementById("ai-alternative").innerHTML = `
                        <div class="alert alert-danger">
                            Sorry, there was an error processing your request. Please try again.
                        </div>
                    `;
                    });
            } else {
                alert("Please enter an ingredient.");
            }
        });

        // Nutrition information functionality
        document.getElementById("nutritionBtn").addEventListener("click", function () {
            let userInput = document.getElementById("nutritionInput").value.trim();

            if (userInput !== "") {
                // Show loading state and result card
                document.getElementById("nutritionLoader").style.display = "block";
                document.getElementById("nutritionResultCard").style.display = "block";
                document.getElementById("ai-nutrition").innerHTML = "";

                fetch('/submit_nutrition', {
                    method: 'POST',
                    body: JSON.stringify({ nutrition: userInput }),
                    headers: { 'Content-Type': 'application/json' }
                })
                    .then(response => response.json())
                    .then(data => {
                        // Format the response better
                        let formattedResponse = formatNutritionResponse(data, userInput);
                        document.getElementById("ai-nutrition").innerHTML = formattedResponse;
                        document.getElementById("nutritionLoader").style.display = "none";
                    })
                    .catch(error => {
                        console.error("Error:", error);
                        document.getElementById("nutritionLoader").style.display = "none";
                        document.getElementById("ai-nutrition").innerHTML = `
                        <div class="alert alert-danger">
                            Sorry, there was an error processing your request. Please try again.
                        </div>
                    `;
                    });
            } else {
                alert("Please enter an ingredient.");
            }
        });

        // Helper function to format alternative response
        function formatAlternativeResponse(data, originalIngredient) {
            // Check if data is a string (backward compatibility)
            if (typeof data === 'string') {
                // Parse the text response into a more structured format
                try {
                    // Look for common patterns in LLM responses
                    const alternatives = parseTextIntoAlternatives(data);
                    
                    let html = `
                        <div class="mb-3">
                            <h4 class="mb-4 border-bottom pb-2">Alternatives for <span class="text-success fw-bold">${originalIngredient}</span></h4>
                            <div class="row row-cols-1 row-cols-md-2 g-4">
                    `;
                    
                    alternatives.forEach(alt => {
                        html += `
                            <div class="col">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center mb-3">
                                            <span class="bg-light rounded-circle p-2 me-3">
                                                <i class="bi bi-arrow-left-right text-success" style="font-size: 1.25rem;"></i>
                                            </span>
                                            <h5 class="card-title mb-0">${alt.name}</h5>
                                        </div>
                                        ${alt.category ? `<h6 class="card-subtitle mb-2 text-muted"><i class="bi bi-tag-fill me-1 small"></i>${alt.category}</h6>` : ''}
                                        <p class="card-text">${alt.description}</p>
                                        ${alt.benefits ? `
                                        <div class="mt-3 pt-2 border-top">
                                            <span class="badge bg-success-subtle text-success mb-1"><i class="bi bi-heart-fill me-1"></i>Benefits</span>
                                            <p class="card-text small mb-0">${alt.benefits}</p>
                                        </div>` : ''}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                            <div class="mt-4 pt-2 border-top text-center">
                                <p class="text-muted small mb-0"><i class="bi bi-info-circle me-1"></i>The alternatives above are based on nutritional similarities and common culinary uses.</p>
                            </div>
                        </div>
                    `;
                    return html;
                } catch (e) {
                    // Fallback simple formatting if parsing fails
                    return `
                        <div class="mb-3">
                            <h4 class="mb-4">Alternatives for <span class="text-success">${originalIngredient}</span></h4>
                            <div class="p-4 bg-light rounded">
                                ${data.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // For structured data (preferred)
            let html = `
                <div class="mb-3">
                    <h4 class="mb-4 border-bottom pb-2">Alternatives for <span class="text-success fw-bold">${originalIngredient}</span></h4>
                    <div class="row row-cols-1 row-cols-md-2 g-4">
            `;
            
            // Assuming data is an array of alternatives
            if (Array.isArray(data.alternatives)) {
                data.alternatives.forEach(alt => {
                    html += `
                        <div class="col">
                            <div class="card h-100 border-0 shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-3">
                                        <span class="bg-light rounded-circle p-2 me-3">
                                            <i class="bi bi-arrow-left-right text-success" style="font-size: 1.25rem;"></i>
                                        </span>
                                        <h5 class="card-title mb-0">${alt.name}</h5>
                                    </div>
                                    ${alt.category ? `<h6 class="card-subtitle mb-2 text-muted"><i class="bi bi-tag-fill me-1 small"></i>${alt.category}</h6>` : ''}
                                    <p class="card-text">${alt.description}</p>
                                    ${alt.health_benefits ? `
                                    <div class="mt-3 pt-2 border-top">
                                        <span class="badge bg-success-subtle text-success mb-1"><i class="bi bi-heart-fill me-1"></i>Benefits</span>
                                        <p class="card-text small mb-0">${alt.health_benefits}</p>
                                    </div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                // Fallback for string data in a different format
                html += `
                    <div class="col-12">
                        <div class="alert alert-success">
                            ${typeof data === 'string' ? data : JSON.stringify(data)}
                        </div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                    <div class="mt-4 pt-2 border-top text-center">
                        <p class="text-muted small mb-0"><i class="bi bi-info-circle me-1"></i>The alternatives above are based on nutritional similarities and common culinary uses.</p>
                    </div>
                </div>
            `;
            return html;
        }

        // Helper function to format nutrition response
        function formatNutritionResponse(data, ingredient) {
            // Check if data is a string (backward compatibility)
            if (typeof data === 'string') {
                // Try to parse the text into structured nutrition data
                try {
                    const nutritionData = parseTextIntoNutrition(data, ingredient);
                    
                    let html = `
                        <div class="nutrition-container">
                            <h4 class="mb-4 border-bottom pb-2">Nutrition Facts: <span class="text-success fw-bold">${ingredient}</span></h4>
                            <div class="row">
                                <div class="col-md-5">
                                    <div class="card shadow-sm mb-4 border-0">
                                        <div class="card-header bg-success text-white">
                                            <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Nutritional Values</h5>
                                            <small>Per 100g serving</small>
                                        </div>
                                        <div class="card-body p-0">
                                            <ul class="list-group list-group-flush">
                    `;
                    
                    // Add each nutrition item with icons
                    nutritionData.nutrition.forEach(item => {
                        let icon = 'circle-fill';
                        if (item.name.toLowerCase().includes('calor')) icon = 'fire';
                        if (item.name.toLowerCase().includes('protein')) icon = 'egg-fill';
                        if (item.name.toLowerCase().includes('fat')) icon = 'droplet-fill';
                        if (item.name.toLowerCase().includes('carb')) icon = 'subtract';
                        if (item.name.toLowerCase().includes('fiber')) icon = 'flower1';
                        if (item.name.toLowerCase().includes('sugar')) icon = 'cup-hot-fill';
                        
                        html += `
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-${icon} me-2 text-success"></i>
                                    ${item.name}
                                </div>
                                <span class="badge bg-light text-dark">${item.value} ${item.unit}</span>
                            </li>
                        `;
                    });
                    
                    html += `
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="card shadow-sm mb-4 border-0">
                                        <div class="card-header bg-success text-white">
                                            <h5 class="mb-0"><i class="bi bi-heart me-2"></i>Health Benefits</h5>
                                        </div>
                                        <div class="card-body">
                                            <ul class="list-unstyled mb-0">
                    `;
                    
                    nutritionData.benefits.forEach(benefit => {
                        html += `<li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>${benefit}</li>`;
                    });
                    
                    html += `
                                            </ul>
                                        </div>
                                    </div>
                                    ${nutritionData.description ? `
                                    <div class="card shadow-sm mb-3 border-0">
                                        <div class="card-header bg-success text-white">
                                            <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Key Information</h5>
                                        </div>
                                        <div class="card-body">
                                            <p class="mb-0">${nutritionData.description}</p>
                                        </div>
                                    </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    return html;
                } catch (e) {
                    // Fallback formatting if parsing fails
                    console.error("Error parsing nutrition text:", e);
                    return `
                        <div class="mb-3">
                            <h4 class="mb-4">Nutrition Facts: <span class="text-success">${ingredient}</span></h4>
                            <div class="p-4 bg-light rounded">
                                ${data.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                }
            }
            
            // For structured data (preferred)
            let html = `
                <div class="nutrition-container">
                    <h4 class="mb-4 border-bottom pb-2">Nutrition Facts: <span class="text-success fw-bold">${ingredient}</span></h4>
                    <div class="row">
                        <div class="col-md-5">
                            <div class="card shadow-sm mb-4 border-0">
                                <div class="card-header bg-success text-white">
                                    <h5 class="mb-0"><i class="bi bi-pie-chart me-2"></i>Nutritional Values</h5>
                                    <small>Per 100g serving</small>
                                </div>
                                <div class="card-body p-0">
                                    <ul class="list-group list-group-flush">
            `;
            
            // Nutrition items
            const nutritionFields = [
                { name: 'Calories', value: data.calories || '—', unit: 'kcal', icon: 'fire' },
                { name: 'Protein', value: data.protein || '—', unit: 'g', icon: 'egg-fill' },
                { name: 'Carbohydrates', value: data.carbs || '—', unit: 'g', icon: 'subtract' },
                { name: 'Fat', value: data.fat || '—', unit: 'g', icon: 'droplet-fill' },
                { name: 'Fiber', value: data.fiber || '—', unit: 'g', icon: 'flower1' },
                { name: 'Sugar', value: data.sugar || '—', unit: 'g', icon: 'cup-hot-fill' }
            ];
            
            nutritionFields.forEach(field => {
                html += `
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-${field.icon} me-2 text-success"></i>
                            ${field.name}
                        </div>
                        <span class="badge bg-light text-dark">${field.value} ${field.unit}</span>
                    </li>
                `;
            });
            
            html += `
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-7">
                        <div class="card shadow-sm mb-4 border-0">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="bi bi-heart me-2"></i>Health Benefits</h5>
                            </div>
                            <div class="card-body">
            `;
            
            // Health benefits
            if (data.benefits && Array.isArray(data.benefits) && data.benefits.length > 0) {
                html += '<ul class="list-unstyled mb-0">';
                data.benefits.forEach(benefit => {
                    html += `<li class="mb-2"><i class="bi bi-check-circle-fill text-success me-2"></i>${benefit}</li>`;
                });
                html += '</ul>';
            } else {
                html += `<p class="card-text mb-0">${data.benefits || 'Information not available'}</p>`;
            }
            
            html += `
                            </div>
                        </div>
                        <div class="card shadow-sm mb-3 border-0">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0"><i class="bi bi-info-circle me-2"></i>Key Information</h5>
                            </div>
                            <div class="card-body">
                                <p class="mb-0">${data.description || 'No additional information available.'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        return html;
    }

    // Helper function to parse LLM text responses into structured alternative data
    function parseTextIntoAlternatives(text) {
        const alternatives = [];
        
        // Try to identify alternatives by patterns like numbers, asterisks, or line breaks
        const lines = text.split(/\n+/);
        
        let currentAlt = null;
        
        for (let line of lines) {
            line = line.trim();
            
            // Skip empty lines
            if (!line) continue;
            
            // Check if this line starts a new alternative (numbered, bullet points, etc.)
            const altNameMatch = line.match(/^(?:\d+\.\s*|\*\s*|•\s*|-\s*|)\s*([A-Za-z][^:]+)(?::|$)/);
            
            if (altNameMatch) {
                // Save previous alternative if exists
                if (currentAlt) {
                    alternatives.push(currentAlt);
                }
                
                // Start new alternative
                currentAlt = {
                    name: altNameMatch[1].trim(),
                    description: '',
                    benefits: ''
                };
                
                // Extract any extra info on the same line after the name
                const extraInfo = line.substring(line.indexOf(currentAlt.name) + currentAlt.name.length).trim();
                if (extraInfo && extraInfo !== ':') {
                    currentAlt.description = extraInfo.replace(/^:\s*/, '');
                }
            } else if (currentAlt) {
                // Detect if this line is about benefits
                if (line.toLowerCase().includes('benefit') || 
                    line.toLowerCase().includes('health') || 
                    line.toLowerCase().includes('advantage')) {
                    currentAlt.benefits += line + ' ';
                } else {
                    // Otherwise add to description
                    currentAlt.description += (currentAlt.description ? ' ' : '') + line;
                }
            }
        }
        
        // Add the last alternative if exists
        if (currentAlt) {
            alternatives.push(currentAlt);
        }
        
        // If no structured alternatives were found, make a simple one
        if (alternatives.length === 0) {
            return [{
                name: 'Alternative Options',
                description: text
            }];
        }
        
        return alternatives;
    }

    // Helper function to parse LLM text responses into structured nutrition data
    function parseTextIntoNutrition(text, ingredientName) {
        const result = {
            nutrition: [],
            benefits: [],
            description: ''
        };
        
        const lines = text.split(/\n+/);
        let section = 'intro'; // Possible values: intro, nutrition, benefits
        
        for (let line of lines) {
            line = line.trim();
            if (!line) continue;
            
            // Determine which section we're in
            if (line.toLowerCase().includes('nutrition') && line.toLowerCase().includes('fact') || 
                line.toLowerCase().includes('nutritional value') || 
                line.toLowerCase().includes('nutrient')) {
                section = 'nutrition';
                continue;
            } else if (line.toLowerCase().includes('benefit') || 
                      line.toLowerCase().includes('health')) {
                section = 'benefits';
                continue;
            }
            
            // Process based on which section we're in
            if (section === 'nutrition') {
                // Look for patterns like "Calories: 105 kcal" or "Protein - 2.3g"
                const nutriMatch = line.match(/^(?:\d+\.\s*|\*\s*|•\s*|-\s*|)\s*([^:]+)[:\-]\s*(.+)/);
                if (nutriMatch) {
                    const nutriName = nutriMatch[1].trim();
                    const value = nutriMatch[2].trim();
                    
                    // Try to separate value and unit
                    const valueUnit = value.match(/^([\d.]+)\s*([a-zA-Z%]+)/);
                    if (valueUnit) {
                        result.nutrition.push({
                            name: nutriName,
                            value: valueUnit[1],
                            unit: valueUnit[2]
                        });
                    } else {
                        result.nutrition.push({
                            name: nutriName,
                            value: value,
                            unit: ''
                        });
                    }
                }
            } else if (section === 'benefits') {
                // Extract benefit points
                if (line.match(/^\d+\.\s*|\*\s*|•\s*|-\s*/)) {
                    result.benefits.push(line.replace(/^\d+\.\s*|\*\s*|•\s*|-\s*/, ''));
                } else if (result.benefits.length > 0) {
                    // Continue previous benefit point
                    result.benefits[result.benefits.length - 1] += ' ' + line;
                } else {
                    // First benefit doesn't have a bullet
                    result.benefits.push(line);
                }
            } else {
                // Intro/description
                result.description += (result.description ? ' ' : '') + line;
            }
        }
        
        // If no structured data was found, create some basic items
        if (result.nutrition.length === 0) {
            // Extract any numbers that look like nutritional values
            const calories = text.match(/(\d+)\s*(?:kcal|calories|cal)/i);
            if (calories) {
                result.nutrition.push({
                    name: 'Calories',
                    value: calories[1],
                    unit: 'kcal'
                });
            }
            
            const protein = text.match(/protein[^.]*?(\d+(?:\.\d+)?)\s*g/i);
            if (protein) {
                result.nutrition.push({
                    name: 'Protein',
                    value: protein[1],
                    unit: 'g'
                });
            }
        }
        
        // If no benefits were identified
        if (result.benefits.length === 0 && result.description) {
            // Try to identify sentences about benefits
            const sentences = result.description.split(/\.\s+/);
            for (let sentence of sentences) {
                if (sentence.toLowerCase().includes('benefit') || 
                    sentence.toLowerCase().includes('good for') || 
                    sentence.toLowerCase().includes('health')) {
                    result.benefits.push(sentence + '.');
                }
            }
        }
        
        return result;
    }

        // Enter key triggers search
        document.getElementById("alternativeInput").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById("alternativeBtn").click();
            }
        });

        document.getElementById("nutritionInput").addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                document.getElementById("nutritionBtn").click();
            }
        });
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
{% endblock %}